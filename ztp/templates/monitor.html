{% extends 'admin/base_site.html' %}
{% block extrahead %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            // Function to fetch updated logs via Ajax
            function fetchUpdatedLogs(containerId) {
                $.ajax({
                    url: '/fetch_logs/',
                    method: 'POST',
                    data: {
                        container_id: containerId
                    },
                    success: function(data) {
                        // Check if there are new logs
                        if (data.logs.trim().length > 0) {
                            // Append new logs to the textarea
                            var $logTextArea = $('#log-' + containerId);
                            $logTextArea.append(data.logs);
                            // Scroll to the bottom
                            $logTextArea.scrollTop($logTextArea[0].scrollHeight);
                        }
                    
                    }
                });
            }

            // Refresh logs every 5 seconds
            setInterval(function(){
                {% for container in docker_containers %}
                    fetchUpdatedLogs('{{ container.container_id }}');
                {% endfor %}
            }, 5000);
        });
    </script>
{% endblock %}
{% block content %}
<h2><i class="fas fa-database"></i> Containers</h2>
{% for container in docker_containers %}
    <div class="card" style="height: 500px;width:1000px">
        <div class="card-body">
            <h5 class="card-title">Name: {{ container.name }}</h5>
            <p class="card-text">Status: {{ container.status }}</p>
            <form method="post" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="container_id" value="{{ container.container_id }}">
                <button type="submit" name="action" value="start" class="btn btn-success">
                    <i class="fas fa-play"></i> Start
                </button>
                <button type="submit" name="action" value="stop" class="btn btn-danger">
                    <i class="fas fa-stop"></i> Stop
                </button>
            </form>
            <!-- Fixed-height log box -->
            <div class="form-group mt-3">
                <label for="log-{{ container.container_id }}">Logs:</label>
                <textarea class="form-control" id="log-{{ container.container_id }}" rows="12" readonly style="resize: none;">
                    {% if container.logs %}
                        {{ container.logs }}
                    {% else %}
                        No logs available.
                    {% endif %}
                </textarea>
            </div>
        </div>
    </div>
{% endfor %}
{% endblock %}
